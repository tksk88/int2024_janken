<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>2äººã®ç›¸æ€§è¨ºæ–­</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>

  <div class="container-sm">
    <div class="row">
      <div class="col">
        <div class="card" style="background-color:white;">
          <div class="card-body">
            <div style="text-align: center;">
              <img src="logo.png" alt="Logo" style="width: 300px; height: auto;">
            </div>
            <p id="hosi" style="font-size: 20px; text-align: center;">ç›¸æ€§ã€0ã€‘</p>
            <p id="message" hidden></p>
            <p id="messages" style="text-align: center; font-size: 20px; color: black;"></p>
            <div class="text-center"> 
              <button class="btn btn-danger" id="webcamButton" disabled>
                ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ğŸ“·
              </button>
            </div>
            <div style="position: relative; text-align: center; margin-top: 20px;">
              <video id="webcam" style="width: 100%; height: auto;" autoplay playsinline></video>
              <div id="canvas" style="position:absolute;left:0px;top:0px;width:100%;height:auto;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const startMessages = [
      "å¤ã¨ã„ãˆã°ï¼Ÿ æµ·:âœŠ ãŠç¥­ã‚Š:âœŒï¸ èŠ±ç«:âœ‹",
      "å¤ç¥­ã‚Šã¨ã„ãˆã°ï¼Ÿ ã‹ãæ°·:âœŠ ã‚Šã‚“ã”ã‚ã‚:âœŒï¸ ç„¼ããã°:âœ‹",
      "å¯æ„›ã„å‹•ç‰©ã¨ã„ãˆã°ï¼Ÿ çŠ¬:âœŠ ã­ã“:âœŒï¸ ã†ã•ã:âœ‹",
      "ãŠå¯¿å¸ã¨ã„ãˆã°ï¼Ÿ ãƒã‚°ãƒ­:âœŠ ã‚µãƒ¼ãƒ¢ãƒ³:âœŒï¸ ãˆã³:âœ‹",
      "ãƒ‰ãƒ©ãˆã‚‚ã‚“ã®é“å…·ã¨ã„ãˆã°ï¼Ÿ ã‚¿ã‚±ã‚³ãƒ—ã‚¿ãƒ¼:âœŠ ã©ã“ã§ã‚‚ãƒ‰ã‚¢:âœŒï¸ ã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³:âœ‹",
    ];

    let currentMessageIndex = 0; 
    let hosi_count = 0; 

    function getNextMessage() {
      const message = startMessages[currentMessageIndex];
      currentMessageIndex = (currentMessageIndex + 1) % startMessages.length;
      return message;
    }

    function getRandomMessage() {
      const randomIndex = Math.floor(Math.random() * startMessages.length);
      return startMessages[randomIndex];
    }

    let result_message = "";
    const socket = io();
    socket.on('leaved', () => {
      document.getElementById('messages').innerText = "ç›¸æ‰‹ãŒã„ã¾ã›ã‚“";
      mode = 0;
    });
    socket.on('new_challenger', (message) => {
      document.getElementById('messages').innerText = "ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã—ã¦ğŸ¤Ÿã‚’ã—ã¦ã­ï¼";
      mode = 1;
    });
    socket.on('you_are_challenger', (message) => {
      document.getElementById('messages').innerText = "ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã—ã¦ğŸ¤Ÿã‚’ã—ã¦ã­ï¼";
      mode = 1;
    });
    socket.on('start', (message) => {
      document.getElementById('messages').innerText = getNextMessage();
      count.play();
      mode = 3;
    });
    socket.on('result', (data) => {
      kirakira.play();
      console.log(data);
      mode = 1;
      let te = {
        me: 0,
        you: 0
      };
      for (d of data) {
        if (d.id != socket.id) {
          te.you = d.janken_type;
        } else {
          te.me = d.janken_type;
        }
      }
      if (te.me == te.you) {
        hosi_count = (hosi_count || 0) + 1;

        if (hosi_count >= 5) {
          result_message = "ç›¸æ€§MAXğŸ¤";
        } else {
          result_message = "ç›¸æ€§ãƒãƒƒãƒãƒªğŸ¤";
        }

        document.getElementById('hosi').innerText = `ç›¸æ€§ã€${'ğŸ’–'.repeat(hosi_count)}ã€‘`;
      } else {
        result_message = "ç›¸æ€§æ®‹å¿µğŸ˜¢";
      }

      setTimeout(() => {
        document.getElementById('messages').innerText = "";
        result_message = "";
      }, 10000);
    });
  </script>

  <!-- include js libraries -->
  <script src="./js/drawing_utils.js" crossorigin="anonymous"></script>
  <script src="./js/hands.js" crossorigin="anonymous"></script>
  <script src="./js/p5.js"></script>
  <script src="./js/p5.sound.js"></script>
  <script src="./js/sketch.js"></script>
  <script type="module" src="./js/script.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>

</body>

</html>

<style>
  body {
    font-family: 'Hiragino Kaku Gothic ProN','ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN W3',sans-serif;
    background-color: pink;
  }
</style>
